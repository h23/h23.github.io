---
title: JS权威指南-函数
date: 2018-08-11 09:09:05
tags: JS
---

# 1. 基础概念

函数组成：

- 形参：在函数体中像局部变量一样工作。
- 实参：函数调用时传入。
- this：本次调用的上下文。

在JS中，函数即对象。

# 2. 函数定义

定义方式：

- function关键字
- 函数名称标识符：若函数定义表达式有name，则该name只存在与函数体中，指代函数对象本身。
- （）放形参
- { } 放函数体
- return，若无则返回undefined

分类：

- 函数声明
  - 会被预解析
  - 不是真正的语句，只能出现在全局代码或内嵌在其他函数中。不能出现在循环，条件判断或try/cache/finally/with语句中。
- 函数表达式

```
内部函数或私有函数的函数名通常以下划线为前缀。
```

# 3. 函数调用

调用方式：

- 作为函数调用
  - 在ES3和非严格的ES5中，this=全局对象
  - 严格模式下，this=undefined
- 作为方法调用
  - 方法=作为对象属性的函数
  - this=当前对象
  - 方法链：当方法的返回值是一个对象，这个对象还可以再调用它的方法。
- 作为构造函数
  - 通过new关键字调用
  - 没有形参的构造函数调用时可省略圆括号
- 间接调用
  - 通过call(), apply()调用

# 4. 函数的实参和形参

以下几点语法可能存在问题：

- 函数定义时未指定形参的类型
- 函数调用时不会对实参做类型检查
- 函数调用时不会检查参数个数

可能存在的问题：

1. 可选形参

   ```
   实参少于形参时，剩下的形参都为undefined。
   建议在定义函数时，给可选形参设置默认值。
   ```

2. 实参对象

   ```
   实参大于形参时，可通过arguments获取未命名值的引用。
   arguments是一个类数组对象。
   第一个实参=arguments[0] 。。。
   callee: 当前正在执行的函数。
   caller：调用当前正在执行的函数的函数。
   在严格模式的ES5中，对callee和caller的读写操作都会产生类型错误。
   ```

3. 将对象属性用作实参

   ```
   形参过多时，不容易记住顺序。可以再定义函数时，将对象作为形参。
   ```

4. 实参类型

   ```
   当形参为string，但实参是非string时，JS会自动进行类型转换。
   其他情况下，会出错。建议先做个类型检查。
   ```

# 5. 作为值的函数

可以将函数赋值给变量，存储在对象的属性或数组的元素中，作为参数传入另一个函数等。
函数可自定义属性:

```
计数器属性：
fun.counter=0;
function fun(){
    return fun.counter++;
}
```

# 6. 作为命名空间的函数

立即调用匿名函数：

```
(function foo(){
   //模块代码 
}())
```

作用：在此命名空间内定义的变量都不会污染到全局命名空间。 

# 7. 闭包

词法作用域：在函数定义时决定，而非调用时决定。
分类：

- 全局作用域
- 局部作用域
- 块级作用域-ES6

作用域链：

- 函数对象可通过作用域链相互关联。
- 内部作用域可访问外层作用域。

闭包通常是定义在一个函数内部的函数，能够读取外城函数内部变量。闭包内的成员会一直存在内存中。

# 8. 函数属性，方法和构造函数

## 8.1 属性

1. length

   ```
   arguments.length 实参的个数
   function.length 形参的个数
   ```

2. prototype

   ```
   指向原型对象
   ```

## 8.2 方法

1. call() apply()

   ```
   间接调用函数
   fun.call(this对象，实参1，实参2。。。)
   fun.apply(this对象，[实参1，实参2。。。])
   ```

2. bind()

   ```
   不调用函数，仅改变this，也可传实参。
   返回由指定的this值和初始化参数改造的原函数拷贝。
   fun.bind(this,实参1，实参2)
   fun(实参3)
   ```

3. toString()

   ```
   fun.toString() 返回函数的源码。
   内置函数返回"[native code]"
   ```

## 8.3 构造函数

```
let fun = new Function("形参1","形参2",...."函数体")
```

注意事项：

- Function()创建的是匿名函数
- 可动态创建编译函数
- 每次调用都会重新编译
- 函数体代码是在全局作用域下编译执行的
- 少用

# 9. 函数式编程

- 使用函数处理数组：利用map，reduce方法处理数组。
- 高阶函数：操作函数的函数，接收函数作为参数，并返回一个新函数。